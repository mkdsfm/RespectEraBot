from gigachat import GigaChat
import os
from gigachat.models import Chat, Messages, MessagesRole

AI_AUTH_KEY = os.getenv("AI_AUTH_KEY")

giga = GigaChat(
   credentials=AI_AUTH_KEY,
   scope="GIGACHAT_API_PERS",
   model="GigaChat",
   ca_bundle_file="russian_trusted_root_ca.cer"
)

SYSTEM_PROMPT = """–¢—ã —Å–æ–∑–¥–∞—ë—à—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ, –∏—Å–∫—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.  
1. –í–æ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Ä–æ–ª—å —á–µ–ª–æ–≤–∫–∞ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ *—Ä–æ–ª—å*) –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤.  
2. –û–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏, –¥–µ–ª–∞–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º.  
3. –ò—Å–ø–æ–ª—å–∑—É–π —è—Ä–∫–∏–µ —ç–ø–∏—Ç–µ—Ç—ã, –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è.  
4. –î–µ–ª–∞–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç —â–µ–¥—Ä—ã–º, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–º –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–º.  
5. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–π —ç–º–æ–¥–∂–∏ –¥–ª—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. üòä  
6. –ö–æ–º–ø–ª–∏–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –º–µ–Ω–µ–µ —á–µ–º –∏–∑ 1024 —Å–∏–º–≤–æ–ª–æ–≤
–ü—Ä–∏–º–µ—Ä:  
–í—Ö–æ–¥: *–∫–æ–ª–ª–µ–≥–∞*, –ê–Ω—è –ª—É—á—à–∏–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É.  
–û—Ç–≤–µ—Ç: –ê–Ω–Ω–∞, —Ç—ã ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å, —Ç—ã ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π –ª–∏–¥–µ—Ä! üåü –¢–≤–æ—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—É –ø—Ä–æ—Å—Ç–æ –≤–æ—Å—Ö–∏—â–∞–µ—Ç. üíñ –° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è –≤–∞–∂–Ω—ã–º –∏ —Ü–µ–Ω–Ω—ã–º, –∞ —ç—Ç–æ –¥–æ—Ä–æ–≥–æ–≥–æ —Å—Ç–æ–∏—Ç. üí™ –¢—ã —É–º–µ–µ—à—å –Ω–∞—Ö–æ–¥–∏—Ç—å –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É, –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—à–µ–Ω–∏—è –∏ –∑–∞—Ä—è–∂–∞—Ç—å —ç–Ω–µ—Ä–≥–∏–µ–π –¥–∞–∂–µ –≤ —Å–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ –¥–Ω–∏. üöÄ –¢–≤–æ—è –º—É–¥—Ä–æ—Å—Ç—å, –¥–æ–±—Ä–æ—Ç–∞ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º –¥–µ–ª–∞—é—Ç —Ç–µ–±—è –Ω–µ–∑–∞–º–µ–Ω–∏–º–æ–π! üåà –°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å —É –Ω–∞—Å ‚Äî —Å —Ç–æ–±–æ–π –º—ã –º–æ–∂–µ–º –≥–æ—Ä—ã —Å–≤–µ—Ä–Ω—É—Ç—å! üòä 

–¢–µ–ø–µ—Ä—å —Ç–≤–æ—è –æ—á–µ—Ä–µ–¥—å! –°–æ–∑–¥–∞–π –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–π—Å—è –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç. üòâ"""

payload = Chat(
        messages=[
            Messages(
                role=MessagesRole.SYSTEM,
                content=SYSTEM_PROMPT
            )
        ],
        temperature=0.7
    )

async def get_ai_response_async(description):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ì–∏–≥–∞-—á–∞—Ç"""

    if len(payload.messages) > 1:
        payload.messages.pop(1)  # –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å –∏–Ω–¥–µ–∫—Å–æ–º 1

    payload.messages.append(
            Messages(
                role=MessagesRole.USER,
                content=description
            ))
    
    response = giga.chat(payload)
    return response.choices[0].message.content + " (c) ai"


async def get_random_text_async(description):

    return await get_ai_response_async(description)